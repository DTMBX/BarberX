<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production Sets · {{ case.case_name }} — Evident</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/design-tokens.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/utilities.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ed-border: var(--color-border, #2a2a4a);
      --ed-surface: var(--color-surface, #1a1a2e);
      --ed-text: var(--color-text-primary, #e0e0e0);
      --ed-text-muted: var(--color-neutral-500, #6a6a8a);
      --ed-accent: var(--color-primary-400, #60a5fa);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: 'Inter', system-ui, sans-serif;
      background: var(--color-bg-primary, #0f0f23); color: var(--ed-text);
    }
    .ed-header {
      display: flex; align-items: center; gap: 1rem;
      padding: 1rem 2rem; border-bottom: 1px solid var(--ed-border);
      background: var(--ed-surface);
    }
    .ed-header h1 { margin: 0; font-size: 1.25rem; font-weight: 600; }
    .ed-nav { display: flex; gap: 0.5rem; margin-left: auto; }
    .ed-nav a {
      font-size: 0.8125rem; color: var(--ed-accent); text-decoration: none;
      padding: 0.35rem 0.75rem; border: 1px solid var(--ed-border);
      border-radius: 0.375rem;
    }
    .ed-nav a:hover { background: rgba(96,165,250,0.1); }
    .ed-content { max-width: 64rem; margin: 2rem auto; padding: 0 2rem; }
    .prod-card {
      background: var(--ed-surface); border: 1px solid var(--ed-border);
      border-radius: 0.5rem; padding: 1.25rem 1.5rem; margin-bottom: 0.75rem;
      display: flex; align-items: center; justify-content: space-between;
      transition: border-color 0.15s;
    }
    .prod-card:hover { border-color: var(--ed-accent); }
    .prod-card h2 { margin: 0; font-size: 1rem; font-weight: 500; }
    .prod-card p { margin: 0.25rem 0 0; font-size: 0.8125rem; color: var(--ed-text-muted); }
    .badge-status {
      display: inline-block; padding: 0.15rem 0.5rem; border-radius: 0.25rem;
      font-size: 0.6875rem; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .badge-draft { background: #6366f120; color: #a5b4fc; }
    .badge-ready { background: #2563eb20; color: #60a5fa; }
    .badge-produced { background: #22c55e15; color: #4ade80; }
    .badge-received { background: #854d0e30; color: #fbbf24; }
    .prod-actions a {
      font-size: 0.8125rem; color: var(--ed-accent); text-decoration: none;
      padding: 0.35rem 0.75rem; border: 1px solid var(--ed-border);
      border-radius: 0.375rem;
    }
    .prod-actions a:hover { background: rgba(96,165,250,0.1); }
    .empty-state {
      text-align: center; padding: 3rem 1rem; color: var(--ed-text-muted);
      font-size: 0.875rem;
    }
    .create-form {
      background: var(--ed-surface); border: 1px solid var(--ed-border);
      border-radius: 0.5rem; padding: 1.25rem 1.5rem; margin-bottom: 1.5rem;
    }
    .create-form h3 { margin: 0 0 0.75rem; font-size: 0.875rem; }
    .form-row { display: flex; gap: 0.75rem; align-items: flex-end; flex-wrap: wrap; }
    .form-field { display: flex; flex-direction: column; gap: 0.25rem; }
    .form-field label { font-size: 0.75rem; color: var(--ed-text-muted); }
    .form-field input {
      padding: 0.4rem 0.65rem; border: 1px solid var(--ed-border);
      border-radius: 0.375rem; background: var(--color-bg-primary, #0f0f23);
      color: var(--ed-text); font-size: 0.8125rem; font-family: inherit;
    }
    .btn-create {
      padding: 0.45rem 1rem; border: none; border-radius: 0.375rem;
      background: var(--ed-accent); color: #fff; font-size: 0.8125rem;
      font-weight: 600; cursor: pointer; font-family: inherit;
    }
    .btn-create:hover { opacity: 0.85; }
    .toast {
      position: fixed; bottom: 1.5rem; right: 1.5rem;
      background: var(--ed-surface); border: 1px solid var(--ed-border);
      padding: 0.75rem 1.25rem; border-radius: 0.5rem; font-size: 0.8125rem;
      transform: translateY(120%); opacity: 0; transition: all 0.3s;
      z-index: 9999;
    }
    .toast.visible { transform: translateY(0); opacity: 1; }
  </style>
</head>
<body>
  <header class="ed-header">
    <h1>Production Sets · {{ case.case_number }}</h1>
    <nav class="ed-nav">
      <a href="{{ url_for('ediscovery.ediscovery_index') }}">eDiscovery</a>
      <a href="{{ url_for('ediscovery.litigation_holds', case_id=case.id) }}">Holds</a>
      <a href="{{ url_for('ediscovery.privilege_log', case_id=case.id) }}">Privilege Log</a>
    </nav>
  </header>

  <main class="ed-content">
    <!-- Create new production set -->
    <section class="create-form">
      <h3>Create Production Set</h3>
      <div class="form-row">
        <div class="form-field">
          <label for="prodNumber">Production number</label>
          <input id="prodNumber" type="text" placeholder="PROD-001" />
        </div>
        <div class="form-field" style="flex:1;">
          <label for="prodDesc">Description</label>
          <input id="prodDesc" type="text" placeholder="First Production to Plaintiff" />
        </div>
        <button class="btn-create" onclick="createProduction()">Create</button>
      </div>
    </section>

    <!-- Existing production sets -->
    <section id="prodList">
      {% if productions %}
        {% for p in productions %}
        <div class="prod-card">
          <div>
            <h2>
              {{ p.production_number or ('PROD-' ~ p.id) }}
              <span class="badge-status badge-{{ p.status or 'draft' }}">{{ p.status or 'draft' }}</span>
            </h2>
            <p>{{ p.description or 'No description' }}
              · {{ p.item_count or 0 }} items
              {% if p.bates_start %} · Bates {{ p.bates_start }}–{{ p.bates_end }}{% endif %}
            </p>
          </div>
          <div class="prod-actions">
            <a href="{{ url_for('ediscovery.production_detail', case_id=case.id, prod_id=p.id) }}">View Items</a>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">No production sets yet. Create one above.</div>
      {% endif %}
    </section>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    var CASE_ID = {{ case.id }};

    async function createProduction() {
      var num = document.getElementById('prodNumber').value.trim();
      var desc = document.getElementById('prodDesc').value.trim();
      if (!num) { showToast('Production number is required'); return; }

      try {
        var resp = await fetch('/api/legal/cases/' + CASE_ID + '/productions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({
            production_number: num,
            description: desc,
          }),
        });
        if (!resp.ok) {
          var err = await resp.json().catch(function() { return {}; });
          throw new Error(err.error || 'Failed');
        }
        showToast('Production set created');
        setTimeout(function() { location.reload(); }, 800);
      } catch(e) {
        showToast('Failed: ' + e.message);
      }
    }

    function showToast(msg) {
      var el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('visible');
      setTimeout(function() { el.classList.remove('visible'); }, 2500);
    }
  </script>
</body>
</html>
